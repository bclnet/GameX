==== Binary: Danae
The file format for Danae

[cols="1,2,2,6"]
|===
|ID |Type |Field |Description

.2+|HDR
2+|
|*Header*

|uint:4
|fatOffset
|Fat Table Offset

.3+|FAT 
2+|seek: fatOffset
|*Fat Table*

|uint:4
|fatSize
|Fat Size

|bytes:+
|fatBytes
|Fat Bytes
|===

[bytefield, target="Arkane_binary_danae"]
----
(draw-column-headers)
(draw-box "fatOffset" {:span 4})
(draw-gap "data")
(draw-box "fatSize" {:span 4})
(draw-box "fatBytes" {:span 4 :borders #{:left :top :bottom}})
(draw-gap-inline)
(draw-box "eof")
(draw-bottom)
----

To deconstruct the fat table:
[,python]
----
# while there are bytes
while b < fatSize:
    dirPath = readString()
    numFiles = readInt32()
    for _ in range(0, numFiles):
        # get file
        file = FileSource(
            path = dirPath + readString(),
            position = readInt32(),
            compressed = readInt32(),
            fileSize = readInt32(),
            packedSize = readInt32())
            # special case
            if file.path.endswith('.FTL'): file.compressed = 1
            elif file.compressed == 0: file.fileSize = file.packedSize
            # add file
            files.append(file)
----

To access a FILE
[,python]
----
r.seek(file.position)
if (file.compressed & 1) != 0: decompressBlast(r, file.packedSize, file.fileSize)
else: r.read(file.packedSize)
----

===== Source code
[,python]
----
include::../../../../python/gamex/families/Arkane/formats/binary.py[tag=Binary_Danae]
----



==== Binary: Void
The file format for Danae

master.index will include other index files as subpaks

[cols="1,2a,2,6"]
|===
|ID |Type |Field |Description

.3+|HDR
2+|
|*Header*

|uint:4
|magic
|assert: 0x04534552

|uint:4
|unknown1
|Unknown

.5+|PAK
2+|repeat: until type == End
|*Sub Paks*

|uint:4
|type
|Sub = 0x18000000, End = 0x18000000

|uint:4
|nameSize
|optional: type == Sub, Size of Name

|ascii:nameSize
|path
|The path

|ushort:2
|packId
|optional: not the first, Pack ID
|===


[bytefield, target="Arkane_binary_void"]
----
(draw-box "header" {:span 3})
(draw-box "sub pack 1" {:span 3 :borders #{:left :top :bottom}})
(draw-gap-inline)
(draw-box "sub pack 2" {:span 3 :borders #{:left :top :bottom}})
(draw-gap-inline)
(draw-box "...")
(draw-box "eof")
(draw-bottom)
----


The normal .index files then use this file format

[cols="1,2,2,6"]
|===
|ID |Type |Field |Description

.5+|HDR
2+|
|*Header*

|uint:4
|unknown1
|Unknown field.

|uint:4
|mainFileSize
|The Main file size.

|byte:24
|unknown2
|Unknown bytes.

|uint:4
|numFiles
|The Number of files.

.11+|FILE
2+|repeat: numFiles
|*File*

|uint:4
|id
|File ID

|ascii:l8
|tag1
|Tag1

|ascii:l8
|tag2
|Tag2

|ascii:l8
|path
|File path.

|ulong:8
|position
|File position.

|uint:4
|fileSize
|File size.

|uint:4
|packedSize
|Packed size.

|uint:4
|unknown1
|Unknown

|uint:4
|flags
|Flags

|ushort:2
|flags2
|Flags2
|===

===== Source code
[,python]
----
include::../../../../python/gamex/families/Arkane/formats/binary.py[tag=Binary_Void]
----